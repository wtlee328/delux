name: Test Secrets Configuration

on:
  workflow_dispatch:

jobs:
  test-secrets:
    name: Verify Secrets
    runs-on: ubuntu-latest
    
    steps:
      - name: Check Required Secrets
        run: |
          echo "Checking if secrets are configured..."
          echo ""
          
          # Check each secret (without revealing values)
          if [ -z "${{ secrets.GCP_PROJECT_ID }}" ]; then
            echo "❌ GCP_PROJECT_ID is NOT set"
          else
            echo "✓ GCP_PROJECT_ID is set"
          fi
          
          if [ -z "${{ secrets.GCP_SA_KEY }}" ]; then
            echo "❌ GCP_SA_KEY is NOT set"
          else
            echo "✓ GCP_SA_KEY is set (length: ${#GCP_SA_KEY})"
          fi
          
          if [ -z "${{ secrets.FIREBASE_SERVICE_ACCOUNT }}" ]; then
            echo "❌ FIREBASE_SERVICE_ACCOUNT is NOT set"
          else
            echo "✓ FIREBASE_SERVICE_ACCOUNT is set"
          fi
          
          if [ -z "${{ secrets.SQL_INSTANCE_NAME }}" ]; then
            echo "❌ SQL_INSTANCE_NAME is NOT set"
          else
            echo "✓ SQL_INSTANCE_NAME is set"
          fi
          
          if [ -z "${{ secrets.DB_NAME }}" ]; then
            echo "❌ DB_NAME is NOT set"
          else
            echo "✓ DB_NAME is set"
          fi
          
          if [ -z "${{ secrets.DB_USER }}" ]; then
            echo "❌ DB_USER is NOT set"
          else
            echo "✓ DB_USER is set"
          fi
          
          if [ -z "${{ secrets.GCS_BUCKET_NAME }}" ]; then
            echo "❌ GCS_BUCKET_NAME is NOT set"
          else
            echo "✓ GCS_BUCKET_NAME is set"
          fi
          
          if [ -z "${{ secrets.SERVICE_ACCOUNT_EMAIL }}" ]; then
            echo "❌ SERVICE_ACCOUNT_EMAIL is NOT set"
          else
            echo "✓ SERVICE_ACCOUNT_EMAIL is set"
          fi
          
          if [ -z "${{ secrets.BACKEND_URL }}" ]; then
            echo "❌ BACKEND_URL is NOT set"
          else
            echo "✓ BACKEND_URL is set"
          fi
          
          if [ -z "${{ secrets.FRONTEND_URL }}" ]; then
            echo "❌ FRONTEND_URL is NOT set"
          else
            echo "✓ FRONTEND_URL is set"
          fi
          
          echo ""
          echo "=========================================="
          echo "Summary"
          echo "=========================================="
          
          # Count missing secrets
          MISSING=0
          [ -z "${{ secrets.GCP_PROJECT_ID }}" ] && ((MISSING++))
          [ -z "${{ secrets.GCP_SA_KEY }}" ] && ((MISSING++))
          [ -z "${{ secrets.FIREBASE_SERVICE_ACCOUNT }}" ] && ((MISSING++))
          [ -z "${{ secrets.SQL_INSTANCE_NAME }}" ] && ((MISSING++))
          [ -z "${{ secrets.DB_NAME }}" ] && ((MISSING++))
          [ -z "${{ secrets.DB_USER }}" ] && ((MISSING++))
          [ -z "${{ secrets.GCS_BUCKET_NAME }}" ] && ((MISSING++))
          [ -z "${{ secrets.SERVICE_ACCOUNT_EMAIL }}" ] && ((MISSING++))
          [ -z "${{ secrets.BACKEND_URL }}" ] && ((MISSING++))
          [ -z "${{ secrets.FRONTEND_URL }}" ] && ((MISSING++))
          
          if [ $MISSING -eq 0 ]; then
            echo "✅ All 10 secrets are configured!"
            exit 0
          else
            echo "❌ $MISSING secret(s) are missing or empty"
            echo ""
            echo "Please add missing secrets at:"
            echo "https://github.com/${{ github.repository }}/settings/secrets/actions"
            exit 1
          fi
        env:
          GCP_SA_KEY: ${{ secrets.GCP_SA_KEY }}
